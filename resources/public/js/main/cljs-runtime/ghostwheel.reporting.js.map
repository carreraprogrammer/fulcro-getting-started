{"version":3,"sources":["ghostwheel/reporting.cljc"],"mappings":"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","names":["ghostwheel.reporting/*all-tests-successful","cljs.core.atom.cljs$core$IFn$_invoke$arity$1","ghostwheel.reporting/wrap","cljs.core.partial.cljs$core$IFn$_invoke$arity$2","ghostwheel.logging/wrap-line","ghostwheel.reporting/inc-report-counter!","cljs.test/inc-report-counter!","ghostwheel.reporting/warning-style","ghostwheel.logging/ghostwheel-colors","ghostwheel.reporting/snippets","js/ghostwheel","js/ghostwheel.reporting","js/ghostwheel.reporting.report","method-table__4613__auto__","prefer-table__4614__auto__","method-cache__4615__auto__","cached-hierarchy__4616__auto__","hierarchy__4617__auto__","cljs.core.get.cljs$core$IFn$_invoke$arity$3","fexpr__57569","cljs.core/MultiFn","cljs.core.symbol.cljs$core$IFn$_invoke$arity$2","ghostwheel.reporting/report","m","ghostwheel.logging.group.cljs$core$IFn$_invoke$arity$2","ghostwheel.logging/group-end","map__57571","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","fail","error","pass","test","warn","passed?","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","warnings?","G__57573","color","label","or__4131__auto__","ghostwheel.logging.log.cljs$core$IFn$_invoke$arity$0","ghostwheel.logging.log.cljs$core$IFn$_invoke$arity$2","cljs.core.dorun.cljs$core$IFn$_invoke$arity$1","cljs.core.repeatedly.cljs$core$IFn$_invoke$arity$2","map__57583","fn-name","fspec","spec-checks","check-coverage","marked-unsafe","report-output","G__57590","G__57591","cljs.core/not","G__57595","G__57596","ghostwheel.reporting/explain-problem-str","failure-type","problem","map__57602","pred","val","in","path","via","G__57607","cljs.core/Keyword","js/Error","cljs.core.into.cljs$core$IFn$_invoke$arity$2","cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core/seq","ghostwheel.reporting/issue-msg","ghostwheel.reporting/report-unexpected-side-effects","message","map__57614","found-fx","ghostwheel.logging/log-bold","cljs.core.map.cljs$core$IFn$_invoke$arity$2","p__57620","vec__57621","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","type","form","details","cljs.core/vec","cljs.core.concat.cljs$core$IFn$_invoke$arity$variadic","ghostwheel.logging/log","cljs.core.doall.cljs$core$IFn$_invoke$arity$1","G__57627","cljs.core/name","ghostwheel.logging.log.cljs$core$IFn$_invoke$arity$1","ghostwheel.reporting/report-unexpected-safety","safe-name","clojure.string/replace","G__57629","p__57630","map__57634","ghostwheel.reporting/report-spec-check","seq__57641","chunk__57645","count__57646","i__57647","temp__5804__auto__","cljs.core/chunked-seq?","c__4550__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","check","test-ret","spec-error","data","msg","e57679","e57700","js/Object","_","args","cljs.core/cons","cljs.core/with-meta","clojure.string/split-lines","sb__4661__auto__","goog.string/StringBuffer","*print-newline*-orig-val__57695","cljs.core/*print-newline*","*print-fn*-orig-val__57696","cljs.core/*print-fn*","*print-newline*-temp-val__57697","*print-fn*-temp-val__57698","x__4662__auto__","*print-newline*-orig-val__57709","*print-fn*-orig-val__57710","*print-newline*-temp-val__57711","*print-fn*-temp-val__57712","fexpr__57699","fexpr__57714","expound.alpha/custom-printer","ghostwheel.logging/*report-output*","ghostwheel.logging.group_collapsed.cljs$core$IFn$_invoke$arity$2","map__57722","failure","summary","G__57727","start-group","ghostwheel.logging/group","G__57731","G__57734","G__57735","G__57736","ghostwheel.logging.DBG.cljs$core$IFn$_invoke$arity$variadic","p1__57745#","p2__57746#","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$3","and__4120__auto__","cljs.test/successful?"],"sourcesContent":[";; Copyright (c) George Lipov. All rights reserved.\n;; The use and distribution terms for this software are covered by the\n;; Eclipse Public License 2.0 (https://choosealicense.com/licenses/epl-2.0/)\n;; which can be found in the file LICENSE at the root of this distribution.\n;; By using this software in any fashion, you are agreeing to be bound by\n;; the terms of this license.\n;; You must not remove this notice, or any other, from this software.\n\n(ns ^:no-doc ghostwheel.reporting\n  (:require [clojure.spec.alpha :as s]\n            [clojure.spec.test.alpha :as st]\n            [clojure.test :as t]\n            [expound.alpha :as expound]\n            [clojure.string :as string]\n            [ghostwheel.logging :as l\n             :refer [log log-bold group group-collapsed group-end DBG]]))\n\n\n(def *all-tests-successful (atom true))\n\n\n(def wrap (partial l/wrap-line 80))\n\n\n(def inc-report-counter! #?(:clj  t/inc-report-counter\n                            :cljs t/inc-report-counter!))\n\n(def warning-style {::l/background (:orange0 l/ghostwheel-colors)})\n\n\n(def snippets\n  {::incomplete-coverage \" => Test coverage incomplete:\"\n   ::no-gen-testing      \" => No generative testing performed\"})\n\n\n(defmulti ^:dynamic report :type)\n\n\n(defmethod report :begin-test-ns [m]\n  (group (str \"Checking \" (:ns m) \" ...\")\n         {::l/background (:base01 l/ghostwheel-colors)}))\n\n\n(defmethod report :end-test-ns [m]\n  (group-end))\n\n\n(defmethod report :summary [m]\n  (let [{:keys [fail error pass test warn]} m\n        passed?   (= pass test)\n        warnings? (some-> warn (> 0))\n        color     (cond\n                    (= test 0) (:black l/ghostwheel-colors)\n                    passed? (:green l/ghostwheel-colors)\n                    :else (:red l/ghostwheel-colors))\n        label     (cond\n                    (= test 0) \"No active tests found\"\n                    passed? (str \"Passed all \" test \" checks\")\n                    :else (str \"Failed \" fail \" of \" test \" checks\"\n                               (when (> error 0)\n                                 (str \"; \" error \" test error(s)\"))))]\n    (do\n      (group-end)\n      (when (or (not passed?) warnings?)\n        (log))\n      (log label {::l/background color})\n      (when warnings?\n        (log (str warn \" warning(s)\")\n             {::l/background (:orange0 l/ghostwheel-colors)}))\n      ;; Might be overkill, but we want to make sure we reset the group nesting\n      ;; in DevTools if anything should blow up above\n      (dorun (repeatedly 5 l/group-end)))))\n\n\n(defmethod report :pass [m]\n  (let [{:keys [::fn-name ::fspec ::spec-checks ::check-coverage\n                ::marked-unsafe ::report-output]} (:message m)]\n    (inc-report-counter! :pass)\n    ;; REVIEW : We don't expect\n    (when check-coverage\n      (cond marked-unsafe\n            (do\n              (inc-report-counter! :warn)\n              (group (str \"WARNING: \"\n                          fn-name\n                          \" \u2013 Function marked as unsafe.\"\n                          (::no-gen-testing snippets)\n                          (::incomplete-coverage snippets))\n                     warning-style)\n              (group-end))\n\n            (not fspec)\n            (do\n              (inc-report-counter! :warn)\n              (group (str \"WARNING: \"\n                          fn-name\n                          \" \u2013 Missing fspec(s)\"\n                          (::no-gen-testing snippets)\n                          (::incomplete-coverage snippets))\n                     warning-style)\n              (group-end))\n\n            (not spec-checks)\n            (do\n              (inc-report-counter! :warn)\n              (group (str \"WARNING: \"\n                          fn-name\n                          \" \u2013 Number of tests set to 0\"\n                          (::no-gen-testing snippets)\n                          (::incomplete-coverage snippets))\n                     warning-style)\n              (group-end))\n\n            :else nil))))\n\n\n;; REVIEW: We don't seem to be needing this anymore.\n(defn- explain-problem-str [failure-type problem]\n  (let [{:keys [pred val in path via]} problem]\n    (case failure-type\n      :check-failed (into {:val val :in in :not pred}\n                          [(when (not= path [:ret]) [:at path])\n                           (when (seq via) [:via via])])\n      :instrument (into {:val val :in in :not pred :at path}\n                        [(when (seq via) [:via via])])\n      :else problem)))\n\n\n(def ^:private issue-msg\n  \"\\nPlease file an issue at https://github.com/gnl/ghostwheel/issues if you encounter false positives or negatives in side effect detection.\")\n\n(defn- report-unexpected-side-effects [message]\n  (let [{:keys [::fn-name ::found-fx]} message]\n    (log-bold \"Possible side effects detected in function marked as safe:\\n\")\n    (->> found-fx\n         ;(map (fn [[type form details]] {:found type :at form :kind details}))\n         (map (fn [[type form details]]\n                (vec (concat [type]\n                             (when form ['at form])\n                             (when details ['kind details])))))\n         (map log)\n         (doall))\n    (->> (str \"=> Either remove the side effects, rename the function to '\"\n              (str (name fn-name) \"!'\")\n              \" to mark it as unsafe, or add ^::g/ignore-fx to its metadata to disable this warning and consider the function safe for automated generative testing.\")\n         wrap\n         log)\n    (log (wrap issue-msg))))\n\n\n(defn- report-unexpected-safety [message]\n  (let [safe-name (string/replace (name (::fn-name message)) #\"!$\" \"\")]\n    (log-bold \"No side effects detected in function marked as unsafe.\")\n    (->> (str \"=> If safe, rename to '\"\n              safe-name\n              \"'. If unsafe, rename the called unsafe functions to suffix them with a '!', or add the ^::g/ignore-fx metadata to disable this check.\")\n         wrap\n         log)\n    (log (wrap issue-msg))\n    log))\n\n\n(defn- report-spec-check [{:keys [::spec-checks ::fn-name]}]\n  (doseq [check spec-checks\n          :let [test-ret (get check #?(:clj  :clojure.spec.test.check/ret\n                                       :cljs :clojure.test.check/ret))]\n          :when (not (:pass? test-ret))\n          :let [spec-error (:result test-ret)\n                data       (.-data spec-error)\n                msg        (try (.-message spec-error)\n                                (catch #?(:cljs js/Object :clj Exception) _ nil))]]\n    (if-not data\n      (log-bold msg)\n      (do\n        (when-let [args (::st/args data)]\n          (log \"\\nCall:\")\n          (log (cons (with-meta fn-name nil) args)))\n        (log)\n        (when (= (::s/failure data) :instrument)\n          (log (-> msg string/split-lines first (str \"\\n\"))))\n        (-> (with-out-str ((expound/custom-printer nil) data))\n            (str \"\\n\")\n            log)\n        ;; REVIEW: Too noisy in the REPL, but\n        ;; maybe add an option to enable it later\n        (when (= l/*report-output* :js-console)\n          (group-collapsed \"Raw error data:\" {::l/background (:base0 l/ghostwheel-colors)})\n          (log msg)\n          (log data)\n          (group-end))))))\n\n\n(defmethod report :fail [m]\n  (let [message     (:message m)\n        {:keys [::fn-name ::failure]} message\n        summary     (case failure\n                      ::unexpected-fx \"Possible side effects detected\"\n                      ::unexpected-safety \"Expected side effects not detected\"\n                      ::spec-failure \"Spec check\"\n                      nil)\n        start-group l/group]\n    (inc-report-counter! :fail)\n    (start-group (str \"FAILED: \" fn-name \" \u2013 \" summary)\n                 {::l/background (:red l/ghostwheel-colors)})\n    (case failure\n      ::unexpected-fx (report-unexpected-side-effects message)\n      ::unexpected-safety (report-unexpected-safety message)\n      ::spec-failure (report-spec-check message)\n      (do\n        (log-bold (str \"Undefined failure reason: \" failure))\n        (log message)))\n    (group-end)))\n\n\n;; REVIEW - test this and clean it up\n(defmethod report :error [m]\n  (DBG m)\n  #_(let [[fn-name spec-check] (:message m)]\n      (do\n        (inc-report-counter! :error)\n        (group (str \"ERROR when testing \" fn-name\n                    {::l/background (:red l/ghostwheel-colors)}))\n        (inc-report-counter! :error)\n        (println \"\\nERROR in\" (t/testing-vars-str m))\n        #?(:cljs (when (seq (:testing-contexts (t/get-current-env)))\n                   (println (t/testing-contexts-str))))\n        (when-let [message (:message m)] (println message))\n        #?(:cljs (t/print-comparison m))\n        (group-end))))\n\n\n(defmethod report :end-run-tests [m]\n  (swap! *all-tests-successful #(and %1 %2) (t/successful? m)))\n\n\n(defmethod report :default [_])\n\n"]}