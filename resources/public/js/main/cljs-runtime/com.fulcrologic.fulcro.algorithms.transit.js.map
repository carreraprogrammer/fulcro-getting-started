{"version":3,"sources":["com/fulcrologic/fulcro/algorithms/transit.cljc"],"mappings":";;;;;AAcG,AAAA;;;;;;AAAA,AAAA,AAAA,AAAA,AAAA,AAASI,AAECE;;AAFV,AAAA,AAAA,AAEQA;AAFR,AAEaC;;;AAFb,AAAA,AAAA,AAAA,AAASH,AAGCI;;AAHV,AAAA,AAAA,AAGQF;AAHR,AAGa,AAAGE;;;AAHhB,AAAA,AAAA,AAAA,AAASJ,AAIOE;;AAJhB,AAAA,AAAA,AAIcA;AAJd,AAAA;;;AAAA,AAAA,AAAA,AAASF;AAAT,AAAA,AAAA;;;AAAA,AAAA,AAAA,AAASA;;AAAT,AAAA,AAAA,AAASA;;AAAT,AAAA,AAAA,AAAAJ,AAAAC,AAAAC,AAASE;AAAT,AAAA,AAAAD,AAAAF,AAAA;;;AAAA;;;AAAA,AAASI;AAAT,AAAA,AAAAD;;;AAASA,AAeT,AAAA;;;;;;AAAA,AAAAK,AAAME;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMD;AAAN,AAMG,AAAA,AAACE;;;AANJ,AAAA,AAAA,AAAMF,AAOFG;AAPJ,AAQG,AAAA,AAACC,AACC,AAAA,AAAA,AAACC,AAASF,AAAgBG,AAAQ,AAAAb;;;AATvC,AAAA,AAAA,AAAMO;;AAAN,AAwBA,AAAA;;;;;AAAA,AAAAF,AAAMU;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAP,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMO;AAAN,AAKG,AAAA,AAACC;;;AALJ,AAAA,AAAA,AAAMD,AAMFL;AANJ,AAOG,AAAA,AAACO,AACC,AAAA,AAAA,AAACL,AAASF,AACGP,AACX,AAAKe;AAAL,AAAS,AAACC,AAAcD;;;;AAV/B,AAAA,AAAA,AAAMH;;AAAN,AA2BH;;;;AAAA,AAAMK,AAGHC;AAHH,AAQW,AAAA,AACE,AAAQ,AAACE,AAAQF;;AADnB;AAAA,AAAAC,AAGkBE;AAHlB,AAAA;;AAKX,AAAA;;;;;;AAAA,AAAAnB,AAAMqB;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC,AAAA,AAAA,AAAA;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAlB,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMkB,AAKFC;AALJ,AAKU,AAAA,AAACC,AAAiBD;;;AAL5B,AAAA,AAAA,AAAMD,AAMFC,AAAKjB;AANT,AAOY,AAACmB,AAAQ,AAACpB,AAAOC,AAAMiB;;;AAPnC,AAAA,AAAA,AAAMD;;AAAN,AAaA,AAAA;;;AAAA,AAAArB,AAAM0B;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC,AAAA,AAAA,AAAA;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAvB,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMuB,AAEFC;AAFJ,AAES,AAAA,AAACC,AAAiBD;;;AAF3B,AAAA,AAAA,AAAMD,AAGFC,AAAItB;AAHR,AAIY,AAACwB,AAAO,AAAClB,AAAON,AAAMsB;;;AAJlC,AAAA,AAAA,AAAMD;;AAAN","names":["this__4374__auto__","writer__4375__auto__","opt__4376__auto__","cljs.core/-write","com.fulcrologic.fulcro.algorithms.transit/TempIdHandler","com.fulcrologic.fulcro.algorithms.transit/->TempIdHandler","_","com.fulcrologic.fulcro.algorithms.tempid/tag","r","var_args","G__51887","com.fulcrologic.fulcro.algorithms.transit/writer","js/Error","com.fulcrologic.fulcro.algorithms.transit.writer.cljs$core$IFn$_invoke$arity$1","opts","cognitect.transit.writer.cljs$core$IFn$_invoke$arity$2","cljs.core/assoc-in","com.fulcrologic.fulcro.algorithms.tempid/TempId","G__51897","com.fulcrologic.fulcro.algorithms.transit/reader","com.fulcrologic.fulcro.algorithms.transit.reader.cljs$core$IFn$_invoke$arity$1","cognitect.transit.reader.cljs$core$IFn$_invoke$arity$2","id","com.fulcrologic.fulcro.algorithms.tempid.tempid.cljs$core$IFn$_invoke$arity$1","com.fulcrologic.fulcro.algorithms.transit/serializable?","v","e51905","com.fulcrologic.fulcro.algorithms.transit.writer.cljs$core$IFn$_invoke$arity$0","e","G__51908","com.fulcrologic.fulcro.algorithms.transit/transit-clj->str","data","com.fulcrologic.fulcro.algorithms.transit.transit_clj__GT_str.cljs$core$IFn$_invoke$arity$2","cognitect.transit/write","G__51925","com.fulcrologic.fulcro.algorithms.transit/transit-str->clj","str","com.fulcrologic.fulcro.algorithms.transit.transit_str__GT_clj.cljs$core$IFn$_invoke$arity$2","cognitect.transit/read"],"sourcesContent":["(ns com.fulcrologic.fulcro.algorithms.transit\n  \"Transit functions for the on-the-wire EDN communication to common remotes. Includes support for Fulcro tempids,\n   and can be extended to support additional application-specific data types.\"\n  #?(:clj\n     (:refer-clojure :exclude [ref]))\n  (:require [cognitect.transit :as t]\n            #?(:cljs [com.cognitect.transit :as ct])\n            [com.fulcrologic.fulcro.algorithms.tempid :as tempid #?@(:cljs [:refer [TempId]])])\n  #?(:clj\n     (:import [com.cognitect.transit\n               TransitFactory WriteHandler ReadHandler]\n              [com.fulcrologic.fulcro.algorithms.tempid TempId])))\n\n#?(:cljs\n   (deftype TempIdHandler []\n     Object\n     (tag [_ _] tempid/tag)\n     (rep [_ r] (. r -id))\n     (stringRep [_ _] nil)))\n\n#?(:clj\n   (deftype TempIdHandler []\n     WriteHandler\n     (tag [_ _] tempid/tag)\n     (rep [_ r] (.-id ^TempId r))\n     (stringRep [_ r] (str tempid/tag \"#\" r))\n     (getVerboseHandler [_] nil)))\n\n#?(:cljs\n   (defn writer\n     \"Create a transit writer.\n\n     - `out`: An acceptable output for transit writers.\n     - `opts`: (optional) options to pass to `cognitect.transit/writer` (such as handlers).\"\n     ([]\n      (writer {}))\n     ([opts]\n      (t/writer :json\n        (assoc-in opts [:handlers TempId] (TempIdHandler.))))))\n\n#?(:clj\n   (defn writer\n     \"Create a transit writer.\n\n     - `out`: An acceptable output for transit writers.\n     - `opts`: (optional) options to pass to `cognitect.transit/writer` (such as data type handlers).\"\n     ([out]\n      (writer out {}))\n     ([out opts]\n      (t/writer out :json\n        (assoc-in opts [:handlers TempId] (TempIdHandler.))))))\n\n#?(:cljs\n   (defn reader\n     \"Create a transit reader.\n\n     - `opts`: (optional) options to pass to `cognitect.transit/reader` (such as data type handlers).\"\n     ([]\n      (reader {}))\n     ([opts]\n      (t/reader :json\n        (assoc-in opts\n          [:handlers tempid/tag]\n          (fn [id] (tempid/tempid id)))))))\n\n#?(:clj\n   (defn reader\n     \"Create a transit reader.\n\n     - `opts`: (optional) options to pass to `cognitect.transit/reader` (such as data type handlers).\"\n     ([in]\n      (reader in {}))\n     ([in opts]\n      (t/reader in :json\n        (assoc-in opts\n          [:handlers tempid/tag]\n          (reify\n            ReadHandler\n            (fromRep [_ id] (TempId. id))))))))\n\n(defn serializable?\n  \"Checks to see that the value in question can be serialized by the default fulcro writer by actually attempting to\n  serialize it.  This is *not* an efficient check.\"\n  [v]\n  #?(:clj  (try\n             (.write (writer (java.io.ByteArrayOutputStream.)) v)\n             true\n             (catch Exception e false))\n     :cljs (try\n             (.write (writer) v)\n             true\n             (catch :default e false))))\n\n(defn transit-clj->str\n  \"Use transit to encode clj data as a string. Useful for encoding initial app state from server-side rendering.\n\n  - `data`: Arbitrary data\n  - `opts`: (optional) Options to send when creating a `writer`.\"\n  ([data] (transit-clj->str data {}))\n  ([data opts]\n   #?(:cljs (t/write (writer opts) data)\n      :clj\n            (with-open [out (java.io.ByteArrayOutputStream.)]\n              (t/write (writer out opts) data)\n              (.toString out \"UTF-8\")))))\n\n(defn transit-str->clj\n  \"Use transit to decode a string into a clj data structure. Useful for decoding initial app state when starting from a server-side rendering.\"\n  ([str] (transit-str->clj str {}))\n  ([str opts]\n   #?(:cljs (t/read (reader opts) str)\n      :clj  (t/read (reader (java.io.ByteArrayInputStream. (.getBytes str \"UTF-8\")) opts)))))\n\n"]}