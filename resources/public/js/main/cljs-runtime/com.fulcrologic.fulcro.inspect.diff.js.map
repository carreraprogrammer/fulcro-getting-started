{"version":3,"sources":["com/fulcrologic/fulcro/inspect/diff.cljc"],"mappings":"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","names":["com.fulcrologic.fulcro.inspect.diff/updates","a","b","cljs.core.reduce.cljs$core$IFn$_invoke$arity$3","p__48314","vec__48315","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","adds","k","v","va","cljs.core.get.cljs$core$IFn$_invoke$arity$3","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core/map?","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","com.fulcrologic.fulcro.inspect.diff/removals","p__48318","vec__48319","rems","temp__5802__auto__","vec__48324","_","vb","cljs.core/find","cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2","childs","cljs.core/seq","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","G__48327","com.fulcrologic.fulcro.inspect.diff/diff","com.fulcrologic.fulcro.inspect.diff/deep-merge","x","y","cljs.core.merge_with.cljs$core$IFn$_invoke$arity$variadic","p__48334","map__48335","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","com.fulcrologic.fulcro.inspect.diff/patch-updates","updates","p__48338","map__48340","com.fulcrologic.fulcro.inspect.diff/patch-removals","removals","final","rem","cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2","vec__48343","cljs.core/first","p1__48337#","cljs.core.update.cljs$core$IFn$_invoke$arity$3","G__48346","G__48347","com.fulcrologic.fulcro.inspect.diff/patch","diff"],"sourcesContent":["(ns com.fulcrologic.fulcro.inspect.diff\n  \"Internal algorithms for sending db diffs to Inspect tool.\"\n  (:require [clojure.spec.alpha :as s]))\n\n(defn updates [a b]\n  (reduce\n    (fn [adds [k v]]\n      (let [va (get a k :fulcro.inspect.lib.diff/unset)]\n        (if (= v va)\n          adds\n          (if (and (map? v) (map? va))\n            (assoc adds k (updates va v))\n            (assoc adds k v)))))\n    {}\n    b))\n\n(defn removals [a b]\n  (reduce\n    (fn [rems [k v]]\n      (if-let [[_ vb] (find b k)]\n        (if (and (map? v) (map? vb) (not= v vb))\n          (let [childs (removals v vb)]\n            (if (seq childs)\n              (conj rems {k childs})\n              rems))\n          rems)\n        (conj rems (cond-> k (map? k) (assoc :fulcro.inspect.lib.diff/key? true)))))\n    []\n    a))\n\n(defn diff [a b]\n  {:fulcro.inspect.lib.diff/updates  (updates a b)\n   :fulcro.inspect.lib.diff/removals (removals a b)})\n\n(defn deep-merge [x y]\n  (if (and (map? x) (map? y))\n    (merge-with deep-merge x y)\n    y))\n\n(defn patch-updates [x {:fulcro.inspect.lib.diff/keys [updates]}]\n  (merge-with deep-merge x updates))\n\n(defn patch-removals [x {:fulcro.inspect.lib.diff/keys [removals]}]\n  (reduce\n    (fn [final rem]\n      (cond\n        (:fulcro.inspect.lib.diff/key? rem)\n        (dissoc final (dissoc rem :fulcro.inspect.lib.diff/key?))\n\n        (map? rem)\n        (let [[k v] (first rem)]\n          (update final k #(patch-removals % {:fulcro.inspect.lib.diff/removals v})))\n\n        :else\n        (dissoc final rem)))\n    x\n    removals))\n\n(defn patch [x diff]\n  (-> x\n      (patch-updates diff)\n      (patch-removals diff)))\n"]}